<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>KD Chart 2: KDChartLayoutItems.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.6 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="namespaces.html">Namespace List</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="namespacemembers.html">Namespace&nbsp;Members</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>KDChartLayoutItems.cpp</h1><a href="_k_d_chart_layout_items_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/****************************************************************************</span>
00002 <span class="comment"> ** Copyright (C) 2006 Klarï¿½vdalens Datakonsult AB.  All rights reserved.</span>
00003 <span class="comment"> **</span>
00004 <span class="comment"> ** This file is part of the KD Chart library.</span>
00005 <span class="comment"> **</span>
00006 <span class="comment"> ** This file may be distributed and/or modified under the terms of the</span>
00007 <span class="comment"> ** GNU General Public License version 2 as published by the Free Software</span>
00008 <span class="comment"> ** Foundation and appearing in the file LICENSE.GPL included in the</span>
00009 <span class="comment"> ** packaging of this file.</span>
00010 <span class="comment"> **</span>
00011 <span class="comment"> ** Licensees holding valid commercial KD Chart licenses may use this file in</span>
00012 <span class="comment"> ** accordance with the KD Chart Commercial License Agreement provided with</span>
00013 <span class="comment"> ** the Software.</span>
00014 <span class="comment"> **</span>
00015 <span class="comment"> ** This file is provided AS IS with NO WARRANTY OF ANY KIND, INCLUDING THE</span>
00016 <span class="comment"> ** WARRANTY OF DESIGN, MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.</span>
00017 <span class="comment"> **</span>
00018 <span class="comment"> ** See http://www.kdab.net/kdchart for</span>
00019 <span class="comment"> **   information about KDChart Commercial License Agreements.</span>
00020 <span class="comment"> **</span>
00021 <span class="comment"> ** Contact info@kdab.net if any conditions of this</span>
00022 <span class="comment"> ** licensing are not clear to you.</span>
00023 <span class="comment"> **</span>
00024 <span class="comment"> **********************************************************************/</span>
00025 
00026 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_layout_items_8h.html">KDChartLayoutItems.h</a>"</span>
00027 <span class="preprocessor">#include "<a class="code" href="_k_d_text_document_8h.html">KDTextDocument.h</a>"</span>
00028 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_abstract_area_8h.html">KDChartAbstractArea.h</a>"</span>
00029 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_abstract_diagram_8h.html">KDChartAbstractDiagram.h</a>"</span>
00030 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_background_attributes_8h.html">KDChartBackgroundAttributes.h</a>"</span>
00031 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_frame_attributes_8h.html">KDChartFrameAttributes.h</a>"</span>
00032 <span class="preprocessor">#include "<a class="code" href="_k_d_chart_paint_context_8h.html">KDChartPaintContext.h</a>"</span>
00033 <span class="preprocessor">#include "KDChartPainterSaver_p.h"</span>
00034 <span class="preprocessor">#include &lt;QTextCursor&gt;</span>
00035 <span class="preprocessor">#include &lt;QTextBlockFormat&gt;</span>
00036 <span class="preprocessor">#include &lt;QTextDocumentFragment&gt;</span>
00037 <span class="preprocessor">#include &lt;QAbstractTextDocumentLayout&gt;</span>
00038 <span class="preprocessor">#include &lt;QLayout&gt;</span>
00039 <span class="preprocessor">#include &lt;QPainter&gt;</span>
00040 <span class="preprocessor">#include &lt;QDebug&gt;</span>
00041 <span class="preprocessor">#include &lt;QCoreApplication&gt;</span>
00042 <span class="preprocessor">#include &lt;QApplication&gt;</span>
00043 <span class="preprocessor">#include &lt;QStringList&gt;</span>
00044 <span class="preprocessor">#include &lt;QStyle&gt;</span>
00045 
00046 <span class="preprocessor">#include &lt;KDABLibFakes&gt;</span>
00047 
00048 <span class="preprocessor">#include &lt;math.h&gt;</span>
00049 
<a name="l00050"></a><a class="code" href="_k_d_chart_layout_items_8cpp.html#a0">00050</a> <span class="preprocessor">#define PI 3.141592653589793</span>
00051 <span class="preprocessor"></span>
00052 
00053 
00054 <span class="comment">//#define DEBUG_ITEMS_PAINT</span>
00055 
<a name="l00064"></a><a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema12">00064</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema12">KDChart::AbstractLayoutItem::setParentWidget</a>( <a class="code" href="class_q_widget.html">QWidget</a>* widget )
00065 {
00066     <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itemp0">mParent</a> = widget;
00067 }
00068 
<a name="l00069"></a><a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema6">00069</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema6">KDChart::AbstractLayoutItem::paintAll</a>( QPainter&amp; painter )
00070 {
00071     <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_abstract_layout_itema1">paint</a>( &amp;painter );
00072 }
00073 
<a name="l00077"></a><a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema7">00077</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema7">KDChart::AbstractLayoutItem::paintCtx</a>( <a class="code" href="class_k_d_chart_1_1_paint_context.html">PaintContext</a>* context )
00078 {
00079     <span class="keywordflow">if</span>( context )
00080         <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_abstract_layout_itema1">paint</a>( context-&gt;<a class="code" href="class_k_d_chart_1_1_paint_context.html#_k_d_chart_1_1_paint_contexta2">painter</a>() );
00081 }
00082 
<a name="l00086"></a><a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema14">00086</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema14">KDChart::AbstractLayoutItem::sizeHintChanged</a>()<span class="keyword">const</span>
00087 {
00088     <span class="comment">// This is exactly like what QWidget::updateGeometry does.</span>
00089 <span class="comment">//  qDebug("KDChart::AbstractLayoutItem::sizeHintChanged() called");</span>
00090     <span class="keywordflow">if</span>( mParent ) {
00091         <span class="keywordflow">if</span> ( mParent-&gt;layout() )
00092             mParent-&gt;layout()-&gt;invalidate();
00093         <span class="keywordflow">else</span>
00094             QApplication::postEvent( mParent, <span class="keyword">new</span> QEvent( QEvent::LayoutRequest ) );
00095     }
00096 }
00097 
00098 
<a name="l00099"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema25">00099</a> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema26">KDChart::TextLayoutItem::TextLayoutItem</a>( <span class="keyword">const</span> QString&amp; text,
00100                                          <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">KDChart::TextAttributes</a>&amp; attributes,
00101                                          <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* area,
00102                                          KDChartEnums::MeasureOrientation orientation,
00103                                          Qt::Alignment alignment )
00104     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( alignment )
00105     , mText( text )
00106     , mAttributes( attributes )
00107     , mAutoReferenceArea( area )
00108     , mAutoReferenceOrientation( orientation )
00109     , cachedSizeHint() <span class="comment">// default this to invalid to force just-in-time calculation before first use of sizeHint()</span>
00110     , cachedFontSize( 0.0 )
00111     , cachedFont( mAttributes.font() )
00112 {
00113 }
00114 
<a name="l00115"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema26">00115</a> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema26">KDChart::TextLayoutItem::TextLayoutItem</a>()
00116     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( Qt::AlignLeft )
00117     , mText()
00118     , mAttributes()
00119     , mAutoReferenceArea( 0 )
00120     , mAutoReferenceOrientation( <a class="code" href="class_k_d_chart_enums.html">KDChartEnums</a>::MeasureOrientationHorizontal )
00121     , cachedSizeHint() <span class="comment">// default this to invalid to force just-in-time calculation before first use of sizeHint()</span>
00122     , cachedFontSize( 0.0 )
00123     , cachedFont( mAttributes.font() )
00124 {
00125 
00126 }
00127 
<a name="l00128"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema15">00128</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema15">KDChart::TextLayoutItem::setAutoReferenceArea</a>( <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* area )
00129 {
00130     mAutoReferenceArea = area;
00131     cachedSizeHint = QSize();
00132     <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>();
00133 }
00134 
<a name="l00135"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema0">00135</a> <span class="keyword">const</span> <a class="code" href="class_q_object.html">QObject</a>* <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema0">KDChart::TextLayoutItem::autoReferenceArea</a>()<span class="keyword"> const</span>
00136 <span class="keyword"></span>{
00137     <span class="keywordflow">return</span> mAutoReferenceArea;
00138 }
00139 
<a name="l00140"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">00140</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema19">KDChart::TextLayoutItem::setText</a>(<span class="keyword">const</span> QString &amp; text)
00141 {
00142     mText = text;
00143     cachedSizeHint = QSize();
00144     <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>();
00145 }
00146 
<a name="l00147"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema23">00147</a> QString <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema23">KDChart::TextLayoutItem::text</a>()<span class="keyword"> const</span>
00148 <span class="keyword"></span>{
00149     <span class="keywordflow">return</span> mText;
00150 }
00151 
<a name="l00157"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema20">00157</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema20">KDChart::TextLayoutItem::setTextAttributes</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">TextAttributes</a> &amp;a )
00158 {
00159     mAttributes = a;
00160     cachedSizeHint = QSize(); <span class="comment">// invalidate size hint</span>
00161     <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>();
00162 }
00163 
<a name="l00169"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema24">00169</a> <a class="code" href="class_k_d_chart_1_1_text_attributes.html">KDChart::TextAttributes</a> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema24">KDChart::TextLayoutItem::textAttributes</a>()<span class="keyword"> const</span>
00170 <span class="keyword"></span>{
00171     <span class="keywordflow">return</span> mAttributes;
00172 }
00173 
00174 
<a name="l00175"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema1">00175</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema1">KDChart::TextLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
00176 <span class="keyword"></span>{
00177     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
00178 }
00179 
<a name="l00180"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema2">00180</a> QRect <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema2">KDChart::TextLayoutItem::geometry</a>()<span class="keyword"> const</span>
00181 <span class="keyword"></span>{
00182     <span class="keywordflow">return</span> mRect;
00183 }
00184 
<a name="l00185"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema5">00185</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema5">KDChart::TextLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
00186 <span class="keyword"></span>{
00187     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
00188 }
00189 
<a name="l00190"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema6">00190</a> QSize <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema6">KDChart::TextLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
00191 <span class="keyword"></span>{
00192     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
00193 }
00194 
<a name="l00195"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema7">00195</a> QSize <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema7">KDChart::TextLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
00196 <span class="keyword"></span>{
00197     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
00198 }
00199 
<a name="l00200"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema16">00200</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema16">KDChart::TextLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
00201 {
00202     mRect = r;
00203 }
00204 
00205 
<a name="l00206"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema13">00206</a> qreal <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema13">KDChart::TextLayoutItem::realFontSize</a>()<span class="keyword"> const</span>
00207 <span class="keyword"></span>{
00208     <span class="keywordflow">return</span> mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa3">calculatedFontSize</a>( mAutoReferenceArea, mAutoReferenceOrientation );
00209 }
00210 
00211 
00212 <span class="keywordtype">bool</span> KDChart::TextLayoutItem::realFontWasRecalculated()<span class="keyword"> const</span>
00213 <span class="keyword"></span>{
00214     <span class="keyword">const</span> qreal fntSiz = <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema13">realFontSize</a>();
00215     <span class="keyword">const</span> <span class="keywordtype">bool</span> bRecalcDone =
00216         ( ( ! cachedSizeHint.isValid() ) || ( cachedFontSize != fntSiz   ) );
00217 
00218     <span class="keywordflow">if</span>( bRecalcDone &amp;&amp; fntSiz &gt; 0.0 ){
00219         cachedFontSize = fntSiz;
00220         cachedFont.setPointSizeF( fntSiz );
00221     }
00222     <span class="keywordflow">return</span> bRecalcDone;
00223 }
00224 
00225 
<a name="l00226"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema12">00226</a> QFont <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema12">KDChart::TextLayoutItem::realFont</a>()<span class="keyword"> const</span>
00227 <span class="keyword"></span>{
00228     realFontWasRecalculated(); <span class="comment">// we can safely ignore the boolean return value</span>
00229     <span class="keywordflow">return</span> cachedFont;
00230 }
00231 
00232 QPolygon KDChart::TextLayoutItem::rotatedCorners()<span class="keyword"> const</span>
00233 <span class="keyword"></span>{
00234     <span class="comment">// the angle in rad</span>
00235     <span class="keyword">const</span> qreal angle = mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa13">rotation</a>() * <a class="code" href="_k_d_chart_layout_items_8cpp.html#a0">PI</a> / 180.0;
00236     QSize size = unrotatedSizeHint();
00237 
00238     <span class="comment">// my P1 - P4 (the four points of the rotated area)</span>
00239     QPointF P1( size.height() * sin( angle ), 0 );
00240     QPointF P2( size.height() * sin( angle ) + size.width() * cos( angle ), size.width() * sin( angle ) );
00241     QPointF P3( size.width() * cos( angle ), size.width() * sin( angle ) + size.height() * cos( angle ) );
00242     QPointF P4( 0, size.height() * cos( angle ) );
00243 
00244     QPolygon result;
00245     result &lt;&lt; P1.toPoint() &lt;&lt; P2.toPoint() &lt;&lt; P3.toPoint() &lt;&lt; P4.toPoint();
00246     <span class="keywordflow">return</span> result;
00247 }
00248 
<a name="l00249"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema4">00249</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema4">KDChart::TextLayoutItem::intersects</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">TextLayoutItem</a>&amp; other, <span class="keyword">const</span> QPointF&amp; myPos, <span class="keyword">const</span> QPointF&amp; otherPos )<span class="keyword"> const</span>
00250 <span class="keyword"></span>{
00251     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema4">intersects</a>( other, myPos.toPoint(), otherPos.toPoint() );
00252 }
00253 
<a name="l00254"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema3">00254</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema4">KDChart::TextLayoutItem::intersects</a>( <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html">TextLayoutItem</a>&amp; other, <span class="keyword">const</span> QPoint&amp; myPos, <span class="keyword">const</span> QPoint&amp; otherPos )<span class="keyword"> const</span>
00255 <span class="keyword"></span>{
00256     <span class="keywordflow">if</span> ( mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa13">rotation</a>() != other.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itemr3">mAttributes</a>.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa13">rotation</a>() )
00257     {
00258         <span class="comment">// that's the code for the common case: the rotation angles don't need to match here</span>
00259         QPolygon myPolygon(          rotatedCorners() );
00260         QPolygon otherPolygon( other.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itemd2">rotatedCorners</a>() );
00261 
00262         <span class="comment">// move the polygons to their positions</span>
00263         myPolygon.translate( myPos );
00264         otherPolygon.translate( otherPos );
00265 
00266         <span class="comment">// create regions out of it</span>
00267         QRegion myRegion( myPolygon );
00268         QRegion otherRegion( otherPolygon );
00269 
00270         <span class="comment">// now the question - do they intersect or not?</span>
00271         <span class="keywordflow">return</span> ! myRegion.intersect( otherRegion ).isEmpty();
00272 
00273     } <span class="keywordflow">else</span> {
00274         <span class="comment">// and that's the code for the special case: the rotation angles match, which is less time consuming in calculation</span>
00275         <span class="keyword">const</span> qreal angle = mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa13">rotation</a>() * <a class="code" href="_k_d_chart_layout_items_8cpp.html#a0">PI</a> / 180.0;
00276         <span class="comment">// both sizes</span>
00277         <span class="keyword">const</span> QSizeF mySize(          unrotatedSizeHint() );
00278         <span class="keyword">const</span> QSizeF otherSize( other.<a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itemd3">unrotatedSizeHint</a>() );
00279 
00280         <span class="comment">// that's myP1 relative to myPos</span>
00281         QPointF myP1( mySize.height() * sin( angle ), 0.0 );
00282         <span class="comment">// that's otherP1 to myPos</span>
00283         QPointF otherP1 = QPointF( otherSize.height() * sin( angle ), 0.0 ) + otherPos - myPos;
00284 
00285         <span class="comment">// now rotate both points the negative angle around myPos</span>
00286         myP1 = QPointF( myP1.x() * cos( -angle ), myP1.x() * sin( -angle ) );
00287         qreal r = sqrt( otherP1.x() * otherP1.x() + otherP1.y() * otherP1.y() );
00288         otherP1 = QPointF( r * cos( -angle ), r * sin( -angle ) );
00289 
00290         <span class="comment">// finally we look, whether both rectangles intersect or even not</span>
00291         <span class="keywordflow">return</span> QRectF( myP1, mySize ).intersects( QRectF( otherP1, otherSize ) );
00292     }
00293 }
00294 
<a name="l00295"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">00295</a> QSize <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema21">KDChart::TextLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
00296 <span class="keyword"></span>{
00297     <span class="keywordflow">if</span>( realFontWasRecalculated() )
00298     {
00299         <span class="keyword">const</span> QSize newSizeHint( calcSizeHint( cachedFont ) );
00300         <span class="keywordflow">if</span>( newSizeHint != cachedSizeHint ){
00301             cachedSizeHint = newSizeHint;
00302             <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema14">sizeHintChanged</a>();
00303         }
00304     }
00305     <span class="comment">//qDebug() &lt;&lt; "-------- KDChart::TextLayoutItem::sizeHint() returns:"&lt;&lt;cachedSizeHint&lt;&lt;" ----------";</span>
00306     <span class="keywordflow">return</span> cachedSizeHint;
00307 }
00308 
00309 
00310 <span class="comment">// PENDING(kalle) Support auto shrink</span>
00311 
00312 
00313 QSize KDChart::TextLayoutItem::unrotatedSizeHint( QFont fnt )<span class="keyword"> const</span>
00314 <span class="keyword"></span>{
00315     <span class="keywordflow">if</span> ( fnt == QFont() )
00316         fnt = cachedFont;
00317 
00318     <span class="keyword">const</span> QFontMetricsF met( fnt, mParent );
00319     QSize ret(0, 0);
00320     <span class="comment">// note: boundingRect() does NOT take any newlines into account</span>
00321     <span class="comment">//       so we need to calculate the size by combining several</span>
00322     <span class="comment">//       rectangles: one per line.  This fixes bugz issue #3720.</span>
00323     <span class="comment">//       (khz, 2007 04 14)</span>
00324     QStringList lines = mText.split(QString::fromAscii(<span class="stringliteral">"\n"</span>));
00325     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lines.size(); ++i){
00326         <span class="keyword">const</span> QSize lSize = met.boundingRect(lines.at(i) ).toRect().size();
00327         ret.setWidth(qMax( ret.width(), lSize.width() ));
00328         ret.rheight() += lSize.height();
00329     }
00330 
00331     <span class="keywordtype">int</span> frame = QApplication::style()-&gt;pixelMetric( QStyle::PM_ButtonMargin, 0, 0 );
00332     <span class="comment">// fine-tuning for small font sizes: the frame must not be so big, if the font is tiny</span>
00333     frame = qMin( frame, ret.height() * 2 / 3 );
00334     <span class="comment">//qDebug() &lt;&lt; "frame:"&lt;&lt; frame;</span>
00335     ret += QSize( frame, frame );
00336     <span class="keywordflow">return</span> ret;
00337     <span class="comment">//const QFontMetricsF met( fnt, mParent );</span>
00338     <span class="comment">//const int frame = QApplication::style()-&gt;pixelMetric( QStyle::PM_ButtonMargin, 0, 0 );</span>
00339     <span class="comment">//return</span>
00340     <span class="comment">//    met.boundingRect( mText ).size().toSize() + QSize( frame, frame );</span>
00341 }
00342 
00343 
00344 QSize KDChart::TextLayoutItem::calcSizeHint( QFont fnt )<span class="keyword"> const</span>
00345 <span class="keyword"></span>{
00346     QSize ret = unrotatedSizeHint( fnt );
00347     <span class="comment">//qDebug() &lt;&lt; "-------- "&lt;&lt;ret.width();</span>
00348     <span class="keyword">const</span> qreal angle = <a class="code" href="_k_d_chart_layout_items_8cpp.html#a0">PI</a> * mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa13">rotation</a>() / 180.0;
00349     <span class="keyword">const</span> qreal cosAngle = cos( angle );
00350     <span class="keyword">const</span> qreal sinAngle = sin( angle );
00351     QSize rotated( qAbs(static_cast&lt;int&gt;( cosAngle * ret.width()  + sinAngle * ret.height() )),
00352                    qAbs(static_cast&lt;int&gt;( cosAngle * ret.height() + sinAngle * ret.width()  )) );
00353     <span class="comment">//qDebug() &lt;&lt; "-------- KDChart::TextLayoutItem::calcSizeHint() returns:"&lt;&lt;rotated&lt;&lt;" ----------";</span>
00354     <span class="keywordflow">return</span> rotated;
00355 }
00356 
<a name="l00357"></a><a class="code" href="_k_d_chart_layout_items_8cpp.html#a1">00357</a> <span class="keyword">static</span> QPointF <a class="code" href="_k_d_chart_layout_items_8cpp.html#a1">rotatedPoint</a>( <span class="keyword">const</span> QPointF&amp; pt, qreal rotation )
00358 {
00359     <span class="keyword">const</span> qreal angle = <a class="code" href="_k_d_chart_layout_items_8cpp.html#a0">PI</a> * rotation / 180.0;
00360     <span class="keyword">const</span> qreal cosAngle = cos( angle );
00361     <span class="keyword">const</span> qreal sinAngle = sin( angle );
00362     <span class="keywordflow">return</span> QPointF(
00363             (cosAngle * pt.x() + sinAngle * pt.y() ),
00364             (cosAngle * pt.y() + sinAngle * pt.x() ) );
00365 }
00366 
<a name="l00367"></a><a class="code" href="_k_d_chart_layout_items_8cpp.html#a2">00367</a> <span class="keyword">static</span> QRectF <a class="code" href="_k_d_chart_layout_items_8cpp.html#a2">rotatedRect</a>( <span class="keyword">const</span> QRectF&amp; rect, qreal angle )
00368 {
00369     <span class="keyword">const</span> QPointF topLeft(  <a class="code" href="_k_d_chart_layout_items_8cpp.html#a1">rotatedPoint</a>( rect.topLeft(),  angle ) );
00370     <span class="comment">//const QPointF topRight( rotatedPoint( rect.topRight(), angle ) );</span>
00371     <span class="comment">//const QPointF bottomLeft(  rotatedPoint( rect.bottomLeft(),  angle ) );</span>
00372     <span class="comment">//const QPointF bottomRight( rotatedPoint( rect.bottomRight(), angle ) );</span>
00373     <span class="keyword">const</span> QPointF siz( <a class="code" href="_k_d_chart_layout_items_8cpp.html#a1">rotatedPoint</a>( QPointF( rect.size().width(), rect.size().height() ), angle ) );
00374     <span class="keyword">const</span> QRectF result(
00375             topLeft,
00376             QSizeF( siz.x(), <span class="comment">//bottomRight.x() - topLeft.x(),</span>
00377                     siz.y() ) ); <span class="comment">//bottomRight.y() - topLeft.y() ) );</span>
00378     <span class="comment">//qDebug() &lt;&lt; "angle" &lt;&lt; angle &lt;&lt; "\nbefore:" &lt;&lt; rect &lt;&lt; "\n after:" &lt;&lt; result;</span>
00379     <span class="keywordflow">return</span> result;
00380 }
00381 
<a name="l00382"></a><a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema8">00382</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema8">KDChart::TextLayoutItem::paint</a>( QPainter* painter )
00383 {
00384     <span class="comment">// make sure, cached font is updated, if needed:</span>
00385     <span class="comment">// sizeHint();</span>
00386 
00387     <span class="keywordflow">if</span>( !mRect.isValid() )
00388         <span class="keywordflow">return</span>;
00389 
00390     PainterSaver painterSaver( painter );
00391     painter-&gt;setFont( cachedFont );
00392     QRectF rect( <a class="code" href="class_k_d_chart_1_1_text_layout_item.html#_k_d_chart_1_1_text_layout_itema2">geometry</a>() );
00393 
00394 <span class="comment">// #ifdef DEBUG_ITEMS_PAINT</span>
00395 <span class="comment">//     painter-&gt;setPen( Qt::black );</span>
00396 <span class="comment">//     painter-&gt;drawRect( rect );</span>
00397 <span class="comment">// #endif</span>
00398     painter-&gt;translate( rect.center() );
00399     rect.moveTopLeft( QPointF( - rect.width() / 2, - rect.height() / 2 ) );
00400 <span class="preprocessor">#ifdef DEBUG_ITEMS_PAINT</span>
00401 <span class="preprocessor"></span>    painter-&gt;setPen( Qt::blue );
00402     painter-&gt;drawRect( rect );
00403 <span class="preprocessor">#endif</span>
00404 <span class="preprocessor"></span>    painter-&gt;rotate( mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa13">rotation</a>() );
00405     rect = <a class="code" href="_k_d_chart_layout_items_8cpp.html#a2">rotatedRect</a>( rect, mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa13">rotation</a>() );
00406 <span class="preprocessor">#ifdef DEBUG_ITEMS_PAINT</span>
00407 <span class="preprocessor"></span>    painter-&gt;setPen( Qt::red );
00408     painter-&gt;drawRect( rect );
00409 <span class="preprocessor">#endif</span>
00410 <span class="preprocessor"></span>    painter-&gt;setPen( mAttributes.<a class="code" href="class_k_d_chart_1_1_text_attributes.html#_k_d_chart_1_1_text_attributesa12">pen</a>() );
00411     painter-&gt;drawText( rect, Qt::AlignHCenter | Qt::AlignVCenter, mText );
00412 <span class="comment">//    if (  calcSizeHint( cachedFont ).width() &gt; rect.width() )</span>
00413 <span class="comment">//        qDebug() &lt;&lt; "rect.width()" &lt;&lt; rect.width() &lt;&lt; "text.width()" &lt;&lt; calcSizeHint( cachedFont ).width();</span>
00414 <span class="comment">//</span>
00415 <span class="comment">//    //painter-&gt;drawText( rect, Qt::AlignHCenter | Qt::AlignVCenter, mText );</span>
00416 }
00417 
<a name="l00418"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema2">00418</a> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema2">KDChart::HorizontalLineLayoutItem::HorizontalLineLayoutItem</a>()
00419     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( Qt::AlignCenter )
00420 {
00421 }
00422 
<a name="l00423"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema0">00423</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema0">KDChart::HorizontalLineLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
00424 <span class="keyword"></span>{
00425     <span class="keywordflow">return</span> Qt::Vertical|Qt::Horizontal; <span class="comment">// Grow both vertically, and horizontally</span>
00426 }
00427 
<a name="l00428"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema1">00428</a> QRect <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema1">KDChart::HorizontalLineLayoutItem::geometry</a>()<span class="keyword"> const</span>
00429 <span class="keyword"></span>{
00430     <span class="keywordflow">return</span> mRect;
00431 }
00432 
<a name="l00433"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema3">00433</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema3">KDChart::HorizontalLineLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
00434 <span class="keyword"></span>{
00435     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
00436 }
00437 
<a name="l00438"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema4">00438</a> QSize <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema4">KDChart::HorizontalLineLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
00439 <span class="keyword"></span>{
00440     <span class="keywordflow">return</span> QSize( QWIDGETSIZE_MAX, QWIDGETSIZE_MAX );
00441 }
00442 
<a name="l00443"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema5">00443</a> QSize <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema5">KDChart::HorizontalLineLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
00444 <span class="keyword"></span>{
00445     <span class="keywordflow">return</span> QSize( 0, 0 );
00446 }
00447 
<a name="l00448"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema11">00448</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema11">KDChart::HorizontalLineLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
00449 {
00450     mRect = r;
00451 }
00452 
<a name="l00453"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema14">00453</a> QSize <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema14">KDChart::HorizontalLineLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
00454 <span class="keyword"></span>{
00455     <span class="keywordflow">return</span> QSize( -1, 3 ); <span class="comment">// see qframe.cpp</span>
00456 }
00457 
00458 
<a name="l00459"></a><a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema6">00459</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_horizontal_line_layout_item.html#_k_d_chart_1_1_horizontal_line_layout_itema6">KDChart::HorizontalLineLayoutItem::paint</a>( QPainter* painter )
00460 {
00461     <span class="keywordflow">if</span>( !mRect.isValid() )
00462         <span class="keywordflow">return</span>;
00463 
00464     painter-&gt;drawLine( QPointF( mRect.left(), mRect.center().y() ),
00465                        QPointF( mRect.right(), mRect.center().y() ) );
00466 }
00467 
00468 
<a name="l00469"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema15">00469</a> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema15">KDChart::VerticalLineLayoutItem::VerticalLineLayoutItem</a>()
00470     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( Qt::AlignCenter )
00471 {
00472 }
00473 
<a name="l00474"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema0">00474</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema0">KDChart::VerticalLineLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
00475 <span class="keyword"></span>{
00476     <span class="keywordflow">return</span> Qt::Vertical|Qt::Vertical; <span class="comment">// Grow both vertically, and horizontally</span>
00477 }
00478 
<a name="l00479"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema1">00479</a> QRect <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema1">KDChart::VerticalLineLayoutItem::geometry</a>()<span class="keyword"> const</span>
00480 <span class="keyword"></span>{
00481     <span class="keywordflow">return</span> mRect;
00482 }
00483 
<a name="l00484"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema2">00484</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema2">KDChart::VerticalLineLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
00485 <span class="keyword"></span>{
00486     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
00487 }
00488 
<a name="l00489"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema3">00489</a> QSize <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema3">KDChart::VerticalLineLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
00490 <span class="keyword"></span>{
00491     <span class="keywordflow">return</span> QSize( QWIDGETSIZE_MAX, QWIDGETSIZE_MAX );
00492 }
00493 
<a name="l00494"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema4">00494</a> QSize <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema4">KDChart::VerticalLineLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
00495 <span class="keyword"></span>{
00496     <span class="keywordflow">return</span> QSize( 0, 0 );
00497 }
00498 
<a name="l00499"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema10">00499</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema10">KDChart::VerticalLineLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
00500 {
00501     mRect = r;
00502 }
00503 
<a name="l00504"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema13">00504</a> QSize <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema13">KDChart::VerticalLineLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
00505 <span class="keyword"></span>{
00506     <span class="keywordflow">return</span> QSize( 3, -1 ); <span class="comment">// see qframe.cpp</span>
00507 }
00508 
00509 
<a name="l00510"></a><a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema5">00510</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_vertical_line_layout_item.html#_k_d_chart_1_1_vertical_line_layout_itema5">KDChart::VerticalLineLayoutItem::paint</a>( QPainter* painter )
00511 {
00512     <span class="keywordflow">if</span>( !mRect.isValid() )
00513         <span class="keywordflow">return</span>;
00514 
00515     painter-&gt;drawLine( QPointF( mRect.center().x(), mRect.top() ),
00516                        QPointF( mRect.center().x(), mRect.bottom() ) );
00517 }
00518 
00519 
00520 
<a name="l00521"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema3">00521</a> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema3">KDChart::MarkerLayoutItem::MarkerLayoutItem</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* diagram,
00522                                              <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_marker_attributes.html">MarkerAttributes</a>&amp; marker,
00523                                              <span class="keyword">const</span> QBrush&amp; brush, <span class="keyword">const</span> QPen&amp; pen,
00524                                              Qt::Alignment alignment )
00525     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( alignment )
00526     , mDiagram( diagram )
00527     , mMarker( marker )
00528     , mBrush( brush )
00529     , mPen( pen )
00530 {
00531 }
00532 
<a name="l00533"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema0">00533</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema0">KDChart::MarkerLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
00534 <span class="keyword"></span>{
00535     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
00536 }
00537 
<a name="l00538"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema1">00538</a> QRect <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema1">KDChart::MarkerLayoutItem::geometry</a>()<span class="keyword"> const</span>
00539 <span class="keyword"></span>{
00540     <span class="keywordflow">return</span> mRect;
00541 }
00542 
<a name="l00543"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema2">00543</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema2">KDChart::MarkerLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
00544 <span class="keyword"></span>{
00545     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
00546 }
00547 
<a name="l00548"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema4">00548</a> QSize <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema4">KDChart::MarkerLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
00549 <span class="keyword"></span>{
00550     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema14">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
00551 }
00552 
<a name="l00553"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema5">00553</a> QSize <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema5">KDChart::MarkerLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
00554 <span class="keyword"></span>{
00555     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema14">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
00556 }
00557 
<a name="l00558"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema11">00558</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema11">KDChart::MarkerLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
00559 {
00560     mRect = r;
00561 }
00562 
<a name="l00563"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema14">00563</a> QSize <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema14">KDChart::MarkerLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
00564 <span class="keyword"></span>{
00565     <span class="comment">//qDebug() &lt;&lt; "KDChart::MarkerLayoutItem::sizeHint() returns:"&lt;&lt;mMarker.markerSize().toSize();</span>
00566     <span class="keywordflow">return</span> mMarker.<a class="code" href="class_k_d_chart_1_1_marker_attributes.html#_k_d_chart_1_1_marker_attributesa4">markerSize</a>().toSize();
00567 }
00568 
<a name="l00569"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema6">00569</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_itema6">KDChart::MarkerLayoutItem::paint</a>( QPainter* painter )
00570 {
00571     <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_iteme0">paintIntoRect</a>( painter, mRect, mDiagram, mMarker, mBrush, mPen );
00572 }
00573 
<a name="l00574"></a><a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_iteme0">00574</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_marker_layout_item.html#_k_d_chart_1_1_marker_layout_iteme0">KDChart::MarkerLayoutItem::paintIntoRect</a>(
00575         QPainter* painter,
00576         <span class="keyword">const</span> QRect&amp; rect,
00577         <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">AbstractDiagram</a>* diagram,
00578         <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_marker_attributes.html">MarkerAttributes</a>&amp; marker,
00579         <span class="keyword">const</span> QBrush&amp; brush,
00580         <span class="keyword">const</span> QPen&amp; pen )
00581 {
00582     <span class="keywordflow">if</span>( ! rect.isValid() )
00583         <span class="keywordflow">return</span>;
00584 
00585     <span class="comment">// The layout management may assign a larger rect than what we</span>
00586     <span class="comment">// wanted. We need to adjust the position.</span>
00587     <span class="keyword">const</span> QSize siz = marker.<a class="code" href="class_k_d_chart_1_1_marker_attributes.html#_k_d_chart_1_1_marker_attributesa4">markerSize</a>().toSize();
00588     QPointF pos = rect.topLeft();
00589     pos += QPointF( static_cast&lt;qreal&gt;(( rect.width()  - siz.width()) / 2.0 ),
00590                     static_cast&lt;qreal&gt;(( rect.height() - siz.height()) / 2.0 ) );
00591 
00592 <span class="preprocessor">#ifdef DEBUG_ITEMS_PAINT</span>
00593 <span class="preprocessor"></span>    QPointF oldPos = pos;
00594 <span class="preprocessor">#endif</span>
00595 <span class="preprocessor"></span>
00596 <span class="comment">// And finally, drawMarker() assumes the position to be the center</span>
00597     <span class="comment">// of the marker, adjust again.</span>
00598     pos += QPointF( static_cast&lt;qreal&gt;( siz.width() ) / 2.0,
00599                     static_cast&lt;qreal&gt;( siz.height() )/ 2.0 );
00600 
00601     diagram-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_diagram.html#_k_d_chart_1_1_ring_diagrama34">paintMarker</a>( painter, marker, brush, pen, pos.toPoint(), siz );
00602 
00603 <span class="preprocessor">#ifdef DEBUG_ITEMS_PAINT</span>
00604 <span class="preprocessor"></span>    <span class="keyword">const</span> QPen oldPen( painter-&gt;pen() );
00605     painter-&gt;setPen( Qt::red );
00606     painter-&gt;drawRect( QRect(oldPos.toPoint(), siz) );
00607     painter-&gt;setPen( oldPen );
00608 <span class="preprocessor">#endif</span>
00609 <span class="preprocessor"></span>}
00610 
00611 
<a name="l00612"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema3">00612</a> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema3">KDChart::LineLayoutItem::LineLayoutItem</a>( <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* diagram,
00613                                          <span class="keywordtype">int</span> length,
00614                                          <span class="keyword">const</span> QPen&amp; pen,
00615                                          Qt::Alignment alignment )
00616     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( alignment )
00617     , mDiagram( diagram )
00618     , mLength( length )
00619     , mPen( pen )
00620 {
00621     <span class="comment">//have a mini pen width</span>
00622     <span class="keywordflow">if</span> ( pen.width() &lt; 2 )
00623         mPen.setWidth( 2 );
00624 }
00625 
<a name="l00626"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema0">00626</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema0">KDChart::LineLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
00627 <span class="keyword"></span>{
00628     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
00629 }
00630 
<a name="l00631"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema1">00631</a> QRect <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema1">KDChart::LineLayoutItem::geometry</a>()<span class="keyword"> const</span>
00632 <span class="keyword"></span>{
00633     <span class="keywordflow">return</span> mRect;
00634 }
00635 
<a name="l00636"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema2">00636</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema2">KDChart::LineLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
00637 <span class="keyword"></span>{
00638     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
00639 }
00640 
<a name="l00641"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema4">00641</a> QSize <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema4">KDChart::LineLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
00642 <span class="keyword"></span>{
00643     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema14">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
00644 }
00645 
<a name="l00646"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema5">00646</a> QSize <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema5">KDChart::LineLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
00647 <span class="keyword"></span>{
00648     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema14">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
00649 }
00650 
<a name="l00651"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema11">00651</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema11">KDChart::LineLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
00652 {
00653     mRect = r;
00654 }
00655 
<a name="l00656"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema14">00656</a> QSize <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema14">KDChart::LineLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
00657 <span class="keyword"></span>{
00658     <span class="keywordflow">return</span> QSize( mLength, mPen.width()+2 );
00659 }
00660 
<a name="l00661"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema6">00661</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_itema6">KDChart::LineLayoutItem::paint</a>( QPainter* painter )
00662 {
00663     <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_iteme0">paintIntoRect</a>( painter, mRect, mPen );
00664 }
00665 
<a name="l00666"></a><a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_iteme0">00666</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_layout_item.html#_k_d_chart_1_1_line_layout_iteme0">KDChart::LineLayoutItem::paintIntoRect</a>(
00667         QPainter* painter,
00668         <span class="keyword">const</span> QRect&amp; rect,
00669         <span class="keyword">const</span> QPen&amp; pen )
00670 {
00671     <span class="keywordflow">if</span>( ! rect.isValid() )
00672         <span class="keywordflow">return</span>;
00673 
00674     <span class="keyword">const</span> QPen oldPen = painter-&gt;pen();
00675     painter-&gt;setPen( pen );
00676     <span class="keyword">const</span> qreal y = rect.center().y();
00677     painter-&gt;drawLine( QPointF( rect.left(), y ),
00678                        QPointF( rect.right(), y ) );
00679     painter-&gt;setPen( oldPen );
00680 }
00681 
00682 
<a name="l00683"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema3">00683</a> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema3">KDChart::LineWithMarkerLayoutItem::LineWithMarkerLayoutItem</a>(
00684         <a class="code" href="class_k_d_chart_1_1_abstract_diagram.html">KDChart::AbstractDiagram</a>* diagram,
00685         <span class="keywordtype">int</span> lineLength,
00686         <span class="keyword">const</span> QPen&amp; linePen,
00687         <span class="keywordtype">int</span> markerOffs,
00688         <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_marker_attributes.html">MarkerAttributes</a>&amp; marker,
00689         <span class="keyword">const</span> QBrush&amp; markerBrush,
00690         <span class="keyword">const</span> QPen&amp; markerPen,
00691         Qt::Alignment alignment )
00692     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( alignment )
00693     , mDiagram(     diagram )
00694     , mLineLength(  lineLength )
00695     , mLinePen(     linePen )
00696     , mMarkerOffs(  markerOffs )
00697     , mMarker(      marker )
00698     , mMarkerBrush( markerBrush )
00699     , mMarkerPen(   markerPen )
00700 {
00701 }
00702 
<a name="l00703"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema0">00703</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema0">KDChart::LineWithMarkerLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
00704 <span class="keyword"></span>{
00705     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
00706 }
00707 
<a name="l00708"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema1">00708</a> QRect <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema1">KDChart::LineWithMarkerLayoutItem::geometry</a>()<span class="keyword"> const</span>
00709 <span class="keyword"></span>{
00710     <span class="keywordflow">return</span> mRect;
00711 }
00712 
<a name="l00713"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema2">00713</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema2">KDChart::LineWithMarkerLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
00714 <span class="keyword"></span>{
00715     <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
00716 }
00717 
<a name="l00718"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema4">00718</a> QSize <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema4">KDChart::LineWithMarkerLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
00719 <span class="keyword"></span>{
00720     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema14">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
00721 }
00722 
<a name="l00723"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema5">00723</a> QSize <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema5">KDChart::LineWithMarkerLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
00724 <span class="keyword"></span>{
00725     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema14">sizeHint</a>(); <span class="comment">// PENDING(kalle) Review, quite inflexible</span>
00726 }
00727 
<a name="l00728"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema11">00728</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema11">KDChart::LineWithMarkerLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
00729 {
00730     mRect = r;
00731 }
00732 
<a name="l00733"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema14">00733</a> QSize <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema14">KDChart::LineWithMarkerLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
00734 <span class="keyword"></span>{
00735     <span class="keyword">const</span> QSize sizeM = mMarker.<a class="code" href="class_k_d_chart_1_1_marker_attributes.html#_k_d_chart_1_1_marker_attributesa4">markerSize</a>().toSize();
00736     <span class="keyword">const</span> QSize sizeL = QSize( mLineLength, mLinePen.width()+2 );
00737     <span class="keywordflow">return</span> QSize( qMax(sizeM.width(),  sizeL.width()),
00738                   qMax(sizeM.height(), sizeL.height()) );
00739 }
00740 
<a name="l00741"></a><a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema6">00741</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_line_with_marker_layout_item.html#_k_d_chart_1_1_line_with_marker_layout_itema6">KDChart::LineWithMarkerLayoutItem::paint</a>( QPainter* painter )
00742 {
00743     <span class="comment">// paint the line over the full width, into the vertical middle of the rect</span>
00744     LineLayoutItem::paintIntoRect( painter, mRect, mLinePen );
00745 
00746     <span class="comment">// paint the marker with the given offset from the left side of the line</span>
00747     <span class="keyword">const</span> QRect r(
00748             QPoint( mRect.x()+mMarkerOffs, mRect.y() ),
00749             QSize( mMarker.<a class="code" href="class_k_d_chart_1_1_marker_attributes.html#_k_d_chart_1_1_marker_attributesa4">markerSize</a>().toSize().width(), mRect.height() ) );
00750     MarkerLayoutItem::paintIntoRect(
00751             painter, r, mDiagram, mMarker, mMarkerBrush, mMarkerPen );
00752 }
00753 
00754 
00755 
<a name="l00756"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema0">00756</a> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema0">KDChart::AutoSpacerLayoutItem::AutoSpacerLayoutItem</a>(
00757         <span class="keywordtype">bool</span> layoutIsAtTopPosition, QHBoxLayout *rightLeftLayout,
00758         <span class="keywordtype">bool</span> layoutIsAtLeftPosition, QVBoxLayout *topBottomLayout )
00759     : <a class="code" href="class_k_d_chart_1_1_abstract_layout_item.html">AbstractLayoutItem</a>( Qt::AlignCenter )
00760     , mLayoutIsAtTopPosition(  layoutIsAtTopPosition )
00761     , mRightLeftLayout( rightLeftLayout )
00762     , mLayoutIsAtLeftPosition( layoutIsAtLeftPosition )
00763     , mTopBottomLayout( topBottomLayout )
00764 {
00765 }
00766 
<a name="l00767"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema1">00767</a> Qt::Orientations <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema1">KDChart::AutoSpacerLayoutItem::expandingDirections</a>()<span class="keyword"> const</span>
00768 <span class="keyword"></span>{
00769     <span class="keywordflow">return</span> 0; <span class="comment">// Grow neither vertically nor horizontally</span>
00770 }
00771 
<a name="l00772"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema2">00772</a> QRect <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema2">KDChart::AutoSpacerLayoutItem::geometry</a>()<span class="keyword"> const</span>
00773 <span class="keyword"></span>{
00774     <span class="keywordflow">return</span> mRect;
00775 }
00776 
<a name="l00777"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema3">00777</a> <span class="keywordtype">bool</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema3">KDChart::AutoSpacerLayoutItem::isEmpty</a>()<span class="keyword"> const</span>
00778 <span class="keyword"></span>{
00779     <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// never empty, otherwise the layout item would not exist</span>
00780 }
00781 
<a name="l00782"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema4">00782</a> QSize <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema4">KDChart::AutoSpacerLayoutItem::maximumSize</a>()<span class="keyword"> const</span>
00783 <span class="keyword"></span>{
00784     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema14">sizeHint</a>();
00785 }
00786 
<a name="l00787"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema5">00787</a> QSize <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema5">KDChart::AutoSpacerLayoutItem::minimumSize</a>()<span class="keyword"> const</span>
00788 <span class="keyword"></span>{
00789     <span class="keywordflow">return</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema14">sizeHint</a>();
00790 }
00791 
<a name="l00792"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema11">00792</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema11">KDChart::AutoSpacerLayoutItem::setGeometry</a>( <span class="keyword">const</span> QRect&amp; r )
00793 {
00794     mRect = r;
00795 }
00796 
00797 
<a name="l00798"></a><a class="code" href="_k_d_chart_layout_items_8cpp.html#a3">00798</a> <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="_k_d_chart_layout_items_8cpp.html#a3">updateCommonBrush</a>( QBrush&amp; commonBrush, <span class="keywordtype">bool</span>&amp; bStart, <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_abstract_area.html">KDChart::AbstractArea</a>&amp; area )
00799 {
00800     <span class="keyword">const</span> <a class="code" href="class_k_d_chart_1_1_background_attributes.html">KDChart::BackgroundAttributes</a> ba( area.<a class="code" href="class_k_d_chart_1_1_abstract_area_base.html#_k_d_chart_1_1_text_areaa2">backgroundAttributes</a>() );
00801     <span class="keyword">const</span> <span class="keywordtype">bool</span> hasSimpleBrush = (
00802             ! area.<a class="code" href="class_k_d_chart_1_1_abstract_area_base.html#_k_d_chart_1_1_text_areaa5">frameAttributes</a>().<a class="code" href="class_k_d_chart_1_1_frame_attributes.html#_k_d_chart_1_1_frame_attributesa2">isVisible</a>() &amp;&amp;
00803             ba.<a class="code" href="class_k_d_chart_1_1_background_attributes.html#_k_d_chart_1_1_background_attributesa4">isVisible</a>() &amp;&amp;
00804             ba.<a class="code" href="class_k_d_chart_1_1_background_attributes.html#_k_d_chart_1_1_background_attributesa9">pixmapMode</a>() == KDChart::BackgroundAttributes::BackgroundPixmapModeNone &amp;&amp;
00805             ba.<a class="code" href="class_k_d_chart_1_1_background_attributes.html#_k_d_chart_1_1_background_attributesa2">brush</a>().gradient() == 0 );
00806     <span class="keywordflow">if</span>( bStart ){
00807         bStart = <span class="keyword">false</span>;
00808         commonBrush = hasSimpleBrush ? ba.<a class="code" href="class_k_d_chart_1_1_background_attributes.html#_k_d_chart_1_1_background_attributesa2">brush</a>() : QBrush();
00809     }<span class="keywordflow">else</span>{
00810         <span class="keywordflow">if</span>( ! hasSimpleBrush || ba.<a class="code" href="class_k_d_chart_1_1_background_attributes.html#_k_d_chart_1_1_background_attributesa2">brush</a>() != commonBrush )
00811         {
00812             commonBrush = QBrush();
00813         }
00814     }
00815 }
00816 
<a name="l00817"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema14">00817</a> QSize <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema14">KDChart::AutoSpacerLayoutItem::sizeHint</a>()<span class="keyword"> const</span>
00818 <span class="keyword"></span>{
00819     QBrush commonBrush;
00820     <span class="keywordtype">bool</span> bStart=<span class="keyword">true</span>;
00821     <span class="comment">// calculate the maximal overlap of the top/bottom axes:</span>
00822     <span class="keywordtype">int</span> topBottomOverlap = 0;
00823     <span class="keywordflow">if</span>( mTopBottomLayout ){
00824         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; mTopBottomLayout-&gt;count(); ++i){
00825             <a class="code" href="class_k_d_chart_1_1_abstract_area.html">AbstractArea</a>* area = dynamic_cast&lt;AbstractArea*&gt;(mTopBottomLayout-&gt;itemAt(i));
00826             <span class="keywordflow">if</span>( area ){
00827                 <span class="comment">//qDebug() &lt;&lt; "AutoSpacerLayoutItem testing" &lt;&lt; area;</span>
00828                 topBottomOverlap =
00829                     mLayoutIsAtLeftPosition
00830                     ? qMax( topBottomOverlap, area-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_area.html#_k_d_chart_1_1_polar_coordinate_planea45">rightOverlap</a>() )
00831                     : qMax( topBottomOverlap, area-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_area.html#_k_d_chart_1_1_polar_coordinate_planea20">leftOverlap</a>() );
00832                 <a class="code" href="_k_d_chart_layout_items_8cpp.html#a3">updateCommonBrush</a>( commonBrush, bStart, *area );
00833             }
00834         }
00835     }
00836     <span class="comment">// calculate the maximal overlap of the left/right axes:</span>
00837     <span class="keywordtype">int</span> leftRightOverlap = 0;
00838     <span class="keywordflow">if</span>( mRightLeftLayout ){
00839         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; mRightLeftLayout-&gt;count(); ++i){
00840             <a class="code" href="class_k_d_chart_1_1_abstract_area.html">AbstractArea</a>* area = dynamic_cast&lt;AbstractArea*&gt;(mRightLeftLayout-&gt;itemAt(i));
00841             <span class="keywordflow">if</span>( area ){
00842                 <span class="comment">//qDebug() &lt;&lt; "AutoSpacerLayoutItem testing" &lt;&lt; area;</span>
00843                 leftRightOverlap =
00844                         mLayoutIsAtTopPosition
00845                         ? qMax( leftRightOverlap, area-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_area.html#_k_d_chart_1_1_polar_coordinate_planea4">bottomOverlap</a>() )
00846                         : qMax( leftRightOverlap, area-&gt;<a class="code" href="class_k_d_chart_1_1_abstract_area.html#_k_d_chart_1_1_polar_coordinate_planea65">topOverlap</a>() );
00847                 <a class="code" href="_k_d_chart_layout_items_8cpp.html#a3">updateCommonBrush</a>( commonBrush, bStart, *area );
00848             }
00849         }
00850     }
00851     <span class="keywordflow">if</span>( topBottomOverlap &gt; 0 &amp;&amp; leftRightOverlap &gt; 0 )
00852         mCommonBrush = commonBrush;
00853     <span class="keywordflow">else</span>
00854         mCommonBrush = QBrush();
00855     mCachedSize = QSize( topBottomOverlap, leftRightOverlap );
00856     <span class="comment">//qDebug() &lt;&lt; mCachedSize;</span>
00857     <span class="keywordflow">return</span> mCachedSize;
00858 }
00859 
00860 
<a name="l00861"></a><a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema6">00861</a> <span class="keywordtype">void</span> <a class="code" href="class_k_d_chart_1_1_auto_spacer_layout_item.html#_k_d_chart_1_1_auto_spacer_layout_itema6">KDChart::AutoSpacerLayoutItem::paint</a>( QPainter* painter )
00862 {
00863     <span class="keywordflow">if</span>( mParentLayout &amp;&amp; mRect.isValid() &amp;&amp; mCachedSize.isValid() &amp;&amp;
00864         mCommonBrush.style() != Qt::NoBrush )
00865     {
00866         QPoint p1( mRect.topLeft() );
00867         QPoint p2( mRect.bottomRight() );
00868         <span class="keywordflow">if</span>( mLayoutIsAtLeftPosition )
00869             p1.rx() += mCachedSize.width() - mParentLayout-&gt;spacing();
00870         <span class="keywordflow">else</span>
00871             p2.rx() -= mCachedSize.width() - mParentLayout-&gt;spacing();
00872         <span class="keywordflow">if</span>( mLayoutIsAtTopPosition ){
00873             p1.ry() += mCachedSize.height() - mParentLayout-&gt;spacing() - 1;
00874             p2.ry() -= 1;
00875         }<span class="keywordflow">else</span>
00876             p2.ry() -= mCachedSize.height() - mParentLayout-&gt;spacing() - 1;
00877         <span class="comment">//qDebug() &lt;&lt; mLayoutIsAtTopPosition &lt;&lt; mLayoutIsAtLeftPosition;</span>
00878         <span class="comment">//qDebug() &lt;&lt; mRect;</span>
00879         <span class="comment">//qDebug() &lt;&lt; mParentLayout-&gt;margin();</span>
00880         <span class="comment">//qDebug() &lt;&lt; QRect( p1, p2 );</span>
00881         <span class="keyword">const</span> QPoint oldBrushOrigin( painter-&gt;brushOrigin() );
00882         <span class="keyword">const</span> QBrush oldBrush( painter-&gt;brush() );
00883         <span class="keyword">const</span> QPen   oldPen(   painter-&gt;pen() );
00884         <span class="keyword">const</span> QPointF newTopLeft( painter-&gt;deviceMatrix().map( p1 ) );
00885         painter-&gt;setBrushOrigin( newTopLeft );
00886         painter-&gt;setBrush( mCommonBrush );
00887         painter-&gt;setPen( Qt::NoPen );
00888         painter-&gt;drawRect( QRect( p1, p2 ) );
00889         painter-&gt;setBrushOrigin( oldBrushOrigin );
00890         painter-&gt;setBrush( oldBrush );
00891         painter-&gt;setPen( oldPen );
00892     }
00893     <span class="comment">// debug code:</span>
00894 <span class="preprocessor">#if 0</span>
00895 <span class="preprocessor"></span>    <span class="comment">//qDebug() &lt;&lt; "KDChart::AutoSpacerLayoutItem::paint()";</span>
00896     <span class="keywordflow">if</span>( !mRect.isValid() )
00897         <span class="keywordflow">return</span>;
00898 
00899     painter-&gt;drawRect( mRect );
00900     painter-&gt;drawLine( QPointF( mRect.x(), mRect.top() ),
00901                        QPointF( mRect.right(), mRect.bottom() ) );
00902     painter-&gt;drawLine( QPointF( mRect.right(), mRect.top() ),
00903                        QPointF( mRect.x(), mRect.bottom() ) );
00904 <span class="preprocessor">#endif</span>
00905 <span class="preprocessor"></span>}
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu May 10 11:06:25 2007 for KD Chart 2 by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 > </a>1.3.6 </small></address>
</body>
</html>
